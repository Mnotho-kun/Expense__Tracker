<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link rel="stylesheet" href="style.css">
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h2>Expense Tracker</h2>
        
        <form id="budget-form">
            <input type="number" step="0.01" id="base-budget" placeholder="Enter Base Budget" required>
            <button type="submit">Set Budget</button>
        </form>

        <form id="expense-form">
            <input type="text" id="description" placeholder="Description" required>
            <input type="number" step="0.01" id="amount" placeholder="Amount" required>
            <button type="submit">Add Entry</button>
        </form>
        
        <p id="budget-status">Budget: $0.00</p>

        <!-- Adjusted Canvas Size -->
        <div style="width: 300px; height: 300px;">
            <canvas id="expense-chart"></canvas>
        </div>
        
        <table id="expense-table">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const budgetForm = document.getElementById('budget-form');
            const expenseForm = document.getElementById('expense-form');
            const tableBody = document.querySelector('#expense-table tbody');
            const budgetStatus = document.getElementById('budget-status');
            const expenseChart = document.getElementById('expense-chart').getContext('2d');

            let baseBudget = 0;
            let currentBudget = 0;
            let expenses = [];

            // Initialize Chart.js
            const chart = new Chart(expenseChart, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Expense Distribution',
                        data: [],
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    const data = chart.data.datasets[0].data[tooltipItem.dataIndex];
                                    return `${chart.data.labels[tooltipItem.dataIndex]}: $${data.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    maintainAspectRatio: false 
                }
            });

            budgetForm.addEventListener('submit', (e) => {
                e.preventDefault();
                baseBudget = parseFloat(document.getElementById('base-budget').value);
                currentBudget = baseBudget;
                budgetStatus.textContent = `Budget: $${currentBudget.toFixed(2)}`;
                budgetForm.reset();
            });

            expenseForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const description = document.getElementById('description').value;
                const amount = parseFloat(document.getElementById('amount').value);

                if (description && !isNaN(amount)) {
                    if (amount > currentBudget) {
                        alert('Not enough budget to add this expense.');
                        return;
                    }

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${description}</td>
                        <td>${amount.toFixed(2)}</td>
                        <td>
                            <button onclick="editEntry(this)">Edit</button>
                            <button onclick="deleteEntry(this)">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);

                    currentBudget -= amount;
                    budgetStatus.textContent = `Budget: $${currentBudget.toFixed(2)}`;

                    expenses.push({ description, amount });
                    updateChart();

                    expenseForm.reset();
                }
            });

            function updateChart() {
                const labels = expenses.map(exp => exp.description);
                const data = expenses.map(exp => exp.amount);

                chart.data.labels = labels;
                chart.data.datasets[0].data = data;
                chart.update();
            }

            window.editEntry = function(button) {
                const row = button.parentElement.parentElement;
                const description = row.children[0].textContent;
                const amount = parseFloat(row.children[1].textContent);

                document.getElementById('description').value = description;
                document.getElementById('amount').value = amount;

                row.remove();
                currentBudget += amount;
                budgetStatus.textContent = `Budget: $${currentBudget.toFixed(2)}`;
                expenses = expenses.filter(exp => exp.description !== description);
                updateChart();
            }

            window.deleteEntry = function(button) {
                if (confirm('Are you sure you want to delete this entry?')) {
                    const row = button.parentElement.parentElement;
                    const amount = parseFloat(row.children[1].textContent);
                    const description = row.children[0].textContent;

                    row.remove();
                    currentBudget += amount; // Add back the amount to budget
                    budgetStatus.textContent = `Budget: $${currentBudget.toFixed(2)}`;
                    expenses = expenses.filter(exp => exp.description !== description);
                    updateChart();
                }
            }
        });
    </script>
</body>
</html>
